import{e,f as t,g as l,B as a,o as n,c as o,u as i,_ as r}from"./index-bb9952dd.js";import{B as m}from"./index.66f719b5.js";import{r as d}from"./region.6db33d55.js";const u=r(e({name:"BePickerView",props:{mode:{type:String,default:"time"},modelValue:{type:[String,Array],default:""},timeFormat:{type:String,default:"yyyy-MM-dd"},timeColumn:{type:Array,default:()=>["year","day"]},timeRange:{type:Object,default:()=>({})},province:{type:String,default:null},regionValueType:{type:String,default:"name"},width:{type:String,default:"100%"},height:{type:String,default:"400rpx"},indicatorStyle:{type:String,default:"height: 40px"},indicatorClass:{type:String,default:null},maskStyle:{type:String,default:null},maskClass:{type:String,default:null},layout:{type:String,default:"default"}},emits:["update:modelValue"],setup(e,{expose:r,emit:u}){const s=e,y=["second","minute","hour","day","month","year"],h={year:"年",month:"月",day:"日",hour:"时",minute:"分",second:"秒"},f={year:[1970,2030],month:[1,12],day:[1,31],hour:[0,23],minute:[0,59],second:[0,59]},c=[4,6,9,11],g=t([]),p=t([]),v=t();let S=[],w={},V={},x=!1;const O=l((()=>"time"===s.mode?"value":"region"==s.mode?s.regionValueType:"value")),M=l((()=>"time"===s.mode?"label":"region"==s.mode?"name":"label")),k=l((()=>{let e="";return"time"===s.mode?e="multiple":"region"==s.mode&&(e="cascade"),e}));a((()=>s.modelValue),(()=>{x||C()})),a([()=>s.mode,()=>s.timeFormat,()=>s.timeColumn,()=>s.timeRange,()=>s.province,()=>s.regionValueType],(()=>{C()}));const b=()=>{x=!0,setTimeout((()=>{x=!1}),100)},C=()=>{_()},j=e=>{if("time"===s.mode){e.forEach(((e,t)=>{let l=S[t];w[l]=e}));let t=I(w,s.timeFormat);b(),u("update:modelValue",t)}else"region"===s.mode&&(b(),u("update:modelValue",e))},R=(e,t)=>{if("time"===s.mode){let l=S[t];if("year"===l){if(-1!==S.indexOf("day")){let t=S.indexOf("month");2===g.value[t]&&F(e)}}else if("month"===l){-1!==S.indexOf("day")&&F(e)}}},F=e=>{let t=S.indexOf("year"),l=S.indexOf("month"),a=S.indexOf("day"),n=-1!==t?p.value[t][e[t]].value:w.year,o=p.value[l][e[l]].value,i=B("day",n,o);v.value.updateSingleColumn(a,i)},_=()=>{"time"===s.mode?(E(),P(),T(),D()):"region"===s.mode&&(D(),T())},E=()=>{let e={};for(const t in f)if(Object.hasOwnProperty.call(f,t)){let l,a=s.timeRange[t];if(a){if(2!==a.length)throw"timeRange属性不合法";if(a[0]>a[1])throw"timeRange属性不合法";if("year"!==t&&(a[0]<f[t][0]||a[1]>f[t][1]))throw"timeRange属性不合法";l=a}else l=f[t];e[t]=l}V=e},P=()=>{let e=s.timeColumn;if(0===e.length||e.length>2)throw"column属性不合法";1===e.length&&e.push(e[0]);let t=y.indexOf(e[1]),l=y.indexOf(e[0]);if(-1===t||-1===l)throw"column属性不合法";if(t>l)throw"column属性不合法";let a=[];for(let n=l;n>=t;n--)a.push(y[n]);S=a},T=()=>{if("time"===s.mode){let e=new Date,t={year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds()};if(s.modelValue){let e=H(s.modelValue,s.timeFormat);if(null===e)throw"时间格式不合法";for(const l in e)if(Object.hasOwnProperty.call(e,l)){const a=e[l];a&&(t[l]=parseInt(a))}}for(const a in t)if(Object.hasOwnProperty.call(t,a)){let e=V[a][0],l=V[a][1];t[a]<e&&(t[a]=e),t[a]>l&&(t[a]=l)}let l=A(t.year,t.month);t.day>l&&(t.day=l),w=t,g.value=S.map((e=>t[e]))}else"region"===s.mode&&(g.value=s.modelValue)},B=(e,t,l)=>{let a=[],n=h[e],o=V[e],i=o[0],r=o[1];if("day"===e){t&&l||(t=w.year,l=w.month);let e=A(t,l);r=Math.min(e,o[1])}for(let m=i;m<=r;m++)a.push({value:m,label:m+n});return a},D=()=>{if("time"===s.mode){let e=[];S.forEach((t=>{let l=B(t);e.push(l)})),p.value=e}else if("region"===s.mode){let e,t=s.province;e=t?d.filter((e=>e.name===t)):d,p.value=e}},A=(e,t)=>{let l=0;if(-1!==c.indexOf(t))l=30;else if(2===t){l=28,(e%4==0&&e%100!=0||e%400==0)&&(l=29)}else l=31;return l},I=(e,t)=>{const l={yyyy:"year",MM:"month",dd:"day",hh:"hour",mm:"minute",ss:"second"};return t.replace(/(yyyy)|(MM)|(dd)|(hh)|(mm)|(ss)/g,(t=>{let a=l[t];return"year"===a?e[a]:String(e[a]).padStart(2,"0")}))},H=(e,t)=>{const l={yyyy:"year",MM:"month",dd:"day",hh:"hour",mm:"minute",ss:"second"};let a=[],n=t.replace(/(yyyy)|(MM)|(dd)|(hh)|(mm)|(ss)/g,(e=>(a.push(e),"yyyy"===e?"(\\d{4})":"(\\d{2})")));n="^"+n+"$";let o=new RegExp(n).exec(e);if(o){let e={year:null,month:null,day:null,hour:null,minute:null,second:null};return o=o.slice(1,a.length+1),o.forEach(((t,n)=>{let o=l[a[n]];e[o]=t})),e}return null};return _(),r({clear:()=>{"time"===s.mode?u("update:modelValue",""):"region"===s.mode&&u("update:modelValue",[])}}),(t,l)=>(n(),o(m,{modelValue:g.value,"onUpdate:modelValue":[l[0]||(l[0]=e=>g.value=e),j],mode:i(k),list:p.value,"value-name":i(O),"label-name":i(M),onChange:R,ref_key:"selectView",ref:v,width:e.width,height:e.height,"indicator-style":e.indicatorStyle,"indicator-class":e.indicatorClass,"mask-style":e.maskStyle,"mask-class":e.maskClass,layout:e.layout},null,8,["modelValue","mode","list","value-name","label-name","width","height","indicator-style","indicator-class","mask-style","mask-class","layout"]))}}),[["__scopeId","data-v-8f33e7d3"]]);export{u as _};
