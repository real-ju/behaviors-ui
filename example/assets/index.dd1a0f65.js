import{e,f as l,B as a,o as t,c as u,w as i,q as s,F as d,s as n,j as m,b as o,t as r,m as v,i as p,P as c,D as f,_ as g}from"./index-075d9373.js";const h=g(e({name:"BeSelectView",options:{virtualHost:!0},props:{modelValue:{type:[Number,String,Array],default:void 0},mode:{type:String,default:"single"},list:{type:Array,default:()=>[]},valueName:{type:String,default:"value"},labelName:{type:String,default:"label"},childName:{type:String,default:"children"},width:{type:String,default:"100%"},height:{type:String,default:"400rpx"},indicatorStyle:{type:String,default:"height: 40px"},indicatorClass:{type:String,default:null},maskStyle:{type:String,default:null},maskClass:{type:String,default:null},layout:{type:String,default:"default"}},emits:["update:modelValue","change"],setup(e,{expose:g,emit:h}){const y=e;let b=[],S=1;const N=l([]),k=l([]);let V=0,w=!1;a((()=>y.modelValue),(()=>{w||A()})),a([()=>y.mode,()=>y.list,()=>y.valueName,()=>y.labelName,()=>y.childName],(()=>{A()}));const x=()=>{let e=N.value.map(((e,l)=>{let a=k.value[l],t=a&&a[e];return t?t.value:null}));-1===e.indexOf(null)&&("single"===y.mode&&(e=e[0]),w=!0,setTimeout((()=>{w=!1}),100),h("update:modelValue",e))},I=e=>{let l=e.detail.value,a=N.value.findIndex(((e,a)=>e!==l[a]));-1!==a&&("single"===y.mode||"multiple"===y.mode?N.value=l:"cascade"===y.mode&&(a<N.value.length-1&&l.splice(a+1,l.length-a-1,...new Array(l.length-a-1).fill(0)),N.value=l,_(a)),x(),h("change",N.value,a))},C=(e,l=0,a=1)=>{e||(e=y.list),e.forEach((e=>{let t={id:S++,value:e[y.valueName],label:e[y.labelName],parentId:l,level:a};b.push(t);let u=e[y.childName];u&&C(u,t.id,a+1)}))},_=(e=-1)=>{for(let l=0;l<V;l++)if(l>e){let e,a=k.value[l],t=k.value[l-1],u=N.value[l-1];if(0===l)e=0;else{let l=t[u];if(!l)break;e=l.id}let i=b.filter((l=>l.parentId===e));a?k.value.splice(l,1,i):k.value.push(i)}},A=()=>{v((()=>{B()}))},B=()=>{if(0===y.list.length)return N.value=[],void(k.value=[]);"single"===y.mode||"multiple"===y.mode?(j(),E()):"cascade"===y.mode&&(b=[],S=1,C(),b.sort(((e,l)=>e.level<l.level?-1:e.level>l.level?1:0)),V=b[b.length-1].level,E(),j()),x()},j=()=>{if("single"===y.mode){let e=y.list.map((e=>({value:e[y.valueName],label:e[y.labelName]})));k.value=[e]}else if("multiple"===y.mode){let e=[];y.list.forEach((l=>{let a=l.map((e=>({value:e[y.valueName],label:e[y.labelName]})));e.push(a)})),k.value=e}else"cascade"===y.mode&&_()},E=()=>{if("single"===y.mode){let e=k.value[0].findIndex((e=>e.value===y.modelValue));-1===e&&(e=0),N.value=[e]}else if("multiple"===y.mode){let e=k.value.map(((e,l)=>{let a=e.findIndex((e=>e.value===y.modelValue[l]));return-1===a&&(a=0),a}));N.value=e}else if("cascade"===y.mode)if(void 0===y.modelValue||0===y.modelValue.length)N.value=new Array(V).fill(0);else{let e=[],l=[];for(let a=0;a<V;a++){let t=y.modelValue[a];if(void 0===t)break;{let u=0;a+1>1&&(u=l[a-1].id);let i=b.filter((e=>e.parentId===u)),s=i.findIndex((e=>e.value===t));if(-1===s)break;e.push(s),l.push(i[s])}}e.length<V&&(e=e.concat(new Array(V-e.length).fill(0))),N.value=e}};return B(),g({updateSingleColumn:(e,l)=>{if("multiple"===y.mode){const a=l.map((e=>({value:e[y.valueName],label:e[y.labelName]})));k.value.splice(e,1,a)}},clear:()=>{"single"===y.mode?h("update:modelValue",void 0):"multiple"!==y.mode&&"cascade"!==y.mode||h("update:modelValue",[])}}),(l,a)=>{const v=p,g=c,h=f;return t(),u(h,{value:N.value,class:"be-select-view",style:m({width:e.width,height:e.height}),"indicator-style":e.indicatorStyle,"indicator-class":e.indicatorClass,"mask-style":e.maskStyle,"mask-class":e.maskClass,onChange:I},{default:i((()=>[(t(!0),s(d,null,n(k.value,((e,l)=>{return t(),u(g,{key:l,style:m({order:(a=l,"row-reverse"===y.layout?k.value.length-a:null)})},{default:i((()=>[(t(!0),s(d,null,n(e,((e,l)=>(t(),u(v,{class:"picker-view-item",key:l},{default:i((()=>[o(r(e.label),1)])),_:2},1024)))),128))])),_:2},1032,["style"]);var a})),128))])),_:1},8,["value","style","indicator-style","indicator-class","mask-style","mask-class"])}}}),[["__scopeId","data-v-97f297d9"]]);export{h as B};
